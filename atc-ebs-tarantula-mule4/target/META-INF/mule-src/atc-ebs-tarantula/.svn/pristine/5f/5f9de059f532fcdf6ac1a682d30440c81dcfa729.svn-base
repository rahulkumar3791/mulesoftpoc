<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd">
	<choice-exception-strategy name="exceptionhandlingChoice_Exception_Strategy">
		<catch-exception-strategy doc:name="Catch Exception Strategy">
			<set-variable variableName="errMsg"
				value="Exception occurred at #[new java.util.Date().toString()]#[&quot;\r\n&quot;] Interface : #[flowVars.flowName] #[&quot;\r\n&quot;]  Exception: #[(exception.cause!=null)?(exception.cause.message):exception]"
				doc:name="errMsg" />
			<set-variable variableName="fullErrorMsg"
				value="Exception occurred at #[new java.util.Date().toString()] #[&quot;\r\n&quot;] Interface : #[flowVars.flowName] #[&quot;\r\n&quot;]  Exception Details: #[org.mule.util.ExceptionUtils.getFullStackTrace(exception)]"
				doc:name="fullErrorMsg" />
			<dw:transform-message doc:name="Transform Message">
				<dw:set-payload><![CDATA[%dw 1.0
%output application/json
---
{
"to_address": p('emailID'),

"body": flowVars.errMsg,

"subject":'[' ++ p('current.environment') ++ '] [' ++ p('current.projectname') ++ '] [FAILURE] Notification', 

"attachment_name":"attachment.txt",

"attachment_content": flowVars.fullErrorMsg
	
}  
]]></dw:set-payload>
			</dw:transform-message>
			<byte-array-to-object-transformer
				doc:name="Byte Array to Object" />
			<http:request config-ref="HTTP_EmailNotification" path="/email"
				method="POST" doc:name="HTTP" />
		</catch-exception-strategy>
	</choice-exception-strategy>
</mule>
