<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sftp="http://www.mulesoft.org/schema/mule/sftp"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:quartz="http://www.mulesoft.org/schema/mule/quartz"
	xmlns:mule-ss="http://www.mulesoft.org/schema/mule/spring-security"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
	xmlns:atc-sftp="http://www.mulesoft.org/schema/mule/atc-sftp"
	xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/quartz http://www.mulesoft.org/schema/mule/quartz/current/mule-quartz.xsd
http://www.mulesoft.org/schema/mule/spring-security http://www.mulesoft.org/schema/mule/spring-security/current/mule-spring-security.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd
http://www.mulesoft.org/schema/mule/atc-sftp http://www.mulesoft.org/schema/mule/atc-sftp/current/mule-atc-sftp.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/sftp http://www.mulesoft.org/schema/mule/sftp/current/mule-sftp.xsd">


	<flow name="health:\\oracle-health" doc:id="ad5b790b-d304-43de-b462-36dbe4103104">
		<db:select doc:name="Select" doc:id="ad5cf5fe-18b7-42d6-8fde-e8da7cf36973" config-ref="Oracle_Configuration">
			<db:sql >select 1 from dual</db:sql>
		</db:select>
		<set-variable value='#["GOOD"]' doc:name="oracle-db-response" doc:id="ecc9f705-c68c-42f8-a2da-ffe92dcee340" variableName="oracledb"/>
		<error-handler >
			<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="a4c87223-1b9e-48c1-8147-35d454b68836" type="ANY">
				<set-variable value='#["BAD"]' doc:name="oracle-db-response" doc:id="3c80a544-d3a7-4252-8780-c6d6b1385d58" variableName="oracledb" />
			</on-error-continue>
		</error-handler>
	</flow>
	<flow name="health:\\tarantula-sqlserver-health" doc:id="703a069b-7dd4-4744-a7c2-2402fc667c7c">
		<db:select doc:name="Select" doc:id="bc6482c8-8e9d-4770-9710-d39a59783412" config-ref="SQL_Server_Database_Config">
			<db:sql >select 1 </db:sql>
		</db:select>
		<set-variable value='#["GOOD"]' doc:name="tarantula-db-response" doc:id="aead2fff-4858-47fa-85f2-a623ac9b135e" variableName="tarantuladb" />
		<error-handler >
			<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="4f6d5d75-917b-4fcf-a0c2-6780a6c7c78a" type="ANY">
				<set-variable value='#["BAD"]' doc:name="tarantula-db-response" doc:id="5d685b60-b280-4d82-835e-b9840273b04e" variableName="tarantuladb" />
			</on-error-continue>
		</error-handler>
	</flow>
	
	<flow name="health:\\health-main" maxConcurrency="1">
		<flow-ref doc:name="health:\\oracle-health" doc:id="107368af-71db-484b-b510-18ce759d60f7" name="health:\\oracle-health"/>
		<flow-ref doc:name="health:\\tarantula-sqlserver-health" doc:id="18e6f214-4ad4-439e-8bd3-3ee286af03af" name="health:\\tarantula-sqlserver-health"/>
		<ee:transform doc:name="healthResponse" doc:id="103e7a9f-4f3b-4300-b1e6-054b5ceb4195" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd 
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd 
http://www.mulesoft.org/schema/mule/api-gateway http://www.mulesoft.org/schema/mule/api-gateway/current/mule-api-gateway.xsd http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
var oracledb = vars.oracledb as String default null
var tarantuladb = vars.tarantuladb as String default null
var health = if(oracledb == "GOOD" and tarantuladb == "GOOD") "GOOD" else "BAD" default "GOOD"
output application/json
---
{
  health: health,
  service: p('current.project.name') ++ '-' ++ p('current.environment'),
  interface_type: p('currrent.project.type') default "REST",
  services: {
  	OracleDBHost: p('tarantula.db.host'),
  	DataBase: oracledb,
  	TarantulaDBHost: p('sql.server.ip'),
  	DataBase: tarantuladb 	
  }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</flow>
</mule>
