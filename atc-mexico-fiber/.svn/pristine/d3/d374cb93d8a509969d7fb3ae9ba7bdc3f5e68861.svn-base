<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<flow name="send-email-audit-Flow" doc:id="ea7da04f-a27b-4874-a264-ec45def3ca70" >
		<scatter-gather doc:name="Scatter-Gather" doc:id="0dc46be8-f0ec-432a-b97d-450126a69d49" >
			<route >
				<flow-ref doc:name="Call-Audit-Flow" doc:id="4cee5915-032a-4cf7-9a33-64a46523d49a" name="call-audit-serviceFlow" />
			</route>
			<route >
				<flow-ref doc:name="Call-Email-Flow" doc:id="948b56f7-2d59-40e0-9ef6-cc0bce360197" name="email-Flow" />
			</route>
		</scatter-gather>
	
</flow>
	
	
	<flow name="email-Flow" doc:id="260f9bd1-d457-4b1a-944c-7e271cf6cb1f" >
		<set-variable value="#[payload]" doc:name="Set Mail Payload" doc:id="305835e5-30c0-4814-9ed1-4f4b358b1416" variableName="DATA"/>
		<set-variable value="${delivery.required}" doc:name="Delivery Required" doc:id="12c32a2d-fae8-48ee-8a1f-9c0d08896447" variableName="deliveryRequired"/>
		<set-variable value="${current.environment}" doc:name="Set Environment" doc:id="4f9f6383-b25f-48f2-acee-bfab83dd828d" variableName="environment"/>
		<set-variable value="${smtp.to.operations}" doc:name="Set to address" doc:id="e8c1e9d5-165a-4cab-9166-0095952862de" variableName="to"/>
		<parse-template doc:name="Email Body" doc:id="5e908eaf-9932-4e1f-af5f-5e3f76152d4c" location="success-failed-error-email.html"/>
		<set-variable value="#[output application/java 
---
if(vars.status == &quot;success&quot; and vars.edificio == &quot;edificio&quot;)
	&quot;[&quot; ++ p('current.environment') ++ &quot;][&quot; ++ p('current.project.name') ++ &quot;][EDIFICIO][&quot; ++ p('edificio.current.project.id') ++ &quot;][Success] &quot; 

else if(vars.status == &quot;success&quot; and vars.sitios == &quot;sitios&quot;)
	&quot;[&quot; ++ p('current.environment') ++ &quot;][&quot; ++ p('current.project.name') ++ &quot;][SITIOS][&quot; ++ p('sitios.current.project.id') ++ &quot;][Success] &quot; 
	
else if(vars.status == &quot;Failed&quot; and vars.edificio == &quot;edificio&quot;)
	&quot;[&quot; ++ p('current.environment') ++ &quot;][&quot; ++ p('current.project.name') ++ &quot;][EDIFICIO][&quot; ++ p('edificio.current.project.id') ++ &quot;][Exception Occurred] &quot;

else
    &quot;[&quot; ++ p('current.environment') ++ &quot;][&quot; ++ p('current.project.name') ++ &quot;][SITIOS][&quot; ++ p('sitios.current.project.id') ++ &quot;][Exception Occurred] &quot;]" doc:name="Set Email Subject" doc:id="74edb51d-f324-4bfb-90f6-c05bf701c8ff" variableName="subject"/>
		<flow-ref doc:name="send-Email-Flow" doc:id="e8aba31a-4393-46f1-adb1-a51fa0d7fae4" name="call-email-serviceFlow"/>
	</flow>
</mule>
